!function($){$.fn.collagePlus=function(options){function resizeRow(obj,row,settings,rownum){for(var imageExtras=settings.padding*(obj.length-1)+obj.length*obj[0][3],overPercent=(settings.albumWidth-imageExtras)/(row-imageExtras),trackWidth=imageExtras,lastRow=row<settings.albumWidth,i=0;i<obj.length;i++){var $obj=$(obj[i][0]),fw=Math.floor(obj[i][1]*overPercent),fh=Math.floor(obj[i][2]*overPercent),isNotLast=!!(i<obj.length-1);!0===settings.allowPartialLastRow&&!0===lastRow&&(fw=obj[i][1],fh=obj[i][2]),trackWidth+=fw,!isNotLast&&trackWidth<settings.albumWidth&&(!0===settings.allowPartialLastRow&&!0===lastRow?fw=fw:fw+=settings.albumWidth-trackWidth),fw--;var $img=$obj.is("img")?$obj:$obj.find("img");$img.width(fw),$obj.is("img")||$obj.width(fw+obj[i][3]),$img.height(fh),$obj.is("img")||$obj.height(fh+obj[i][4]),applyModifications($obj,isNotLast,settings),$img.one("load",function(target){return function(){if("default"==settings.effect)target.animate({opacity:"1"},{duration:settings.fadeSpeed});else{if("vertical"==settings.direction)sequence=rownum<=10?rownum:10;else var sequence=i<=9?i+1:10;target.removeClass(function(index,css){return(css.match(/\beffect-\S+/g)||[]).join(" ")}),target.addClass(settings.effect),target.addClass("effect-duration-"+sequence)}}}($obj)).each(function(){this.complete&&$(this).trigger("load")})}}function applyModifications($obj,isNotLast,settings){var css={"margin-bottom":settings.padding+"px","margin-right":isNotLast?settings.padding+"px":"0px",display:settings.display,"vertical-align":"bottom",overflow:"hidden"};return $obj.css(css)}function getImgProperty(img){$img=$(img);var params=new Array;return params.w=parseFloat($img.css("border-left-width"))+parseFloat($img.css("border-right-width")),params.h=parseFloat($img.css("border-top-width"))+parseFloat($img.css("border-bottom-width")),params}return this.each(function(){var row=0,elements=[],rownum=1,$this=$(this);$.fn.collagePlus.defaults.albumWidth=$this.width(),$.fn.collagePlus.defaults.padding=parseFloat($this.css("padding-left")),$.fn.collagePlus.defaults.images=$this.children();var settings=$.extend({},$.fn.collagePlus.defaults,options);settings.images.each(function(index){var $this=$(this),$img=$this.is("img")?$this:$(this).find("img"),w=void 0!==$img.data("width")?$img.data("width"):$img.width(),h=void 0!==$img.data("height")?$img.data("height"):$img.height(),imgParams=getImgProperty($img);$img.data("width",w),$img.data("height",h);var nw=Math.ceil(w/h*settings.targetHeight),nh=Math.ceil(settings.targetHeight);elements.push([this,nw,nh,imgParams.w,imgParams.h]),(row+=nw+imgParams.w+settings.padding)>settings.albumWidth&&0!=elements.length&&(resizeRow(elements,row-settings.padding,settings,rownum),delete row,delete elements,row=0,elements=[],rownum+=1),settings.images.length-1==index&&0!=elements.length&&(resizeRow(elements,row,settings,rownum),delete row,delete elements,row=0,elements=[],rownum+=1)})})},$.fn.collagePlus.defaults={targetHeight:400,fadeSpeed:"fast",display:"inline-block",effect:"default",direction:"vertical",allowPartialLastRow:!1}}(jQuery);